<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="layout/base :: layout(~{::title}, ~{::content}, ~{::scripts})">
<head>
    <title>Edit Item - Themelyf Dashboard</title>
</head>
<body>
    <div th:fragment="content" class="px-4 py-6 sm:px-0">
            <div class="mb-6">
                <nav class="flex" aria-label="Breadcrumb">
                    <ol class="inline-flex items-center space-x-1 md:space-x-3">
                        <li class="inline-flex items-center">
                            <a href="/" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-primary">
                                <i class="fas fa-home mr-2"></i>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <div class="flex items-center">
                                <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                                <span class="text-sm font-medium text-gray-500">Edit Item</span>
                            </div>
                        </li>
                    </ol>
                </nav>
            </div>

            <div class="bg-white shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900">Edit Item</h1>
                        <p class="text-gray-600 mt-1">Update the item details below.</p>
                    </div>

                    <form action="/item/save" method="post" class="space-y-6">
                        <input type="hidden" name="id" th:value="${item.id}">
                        
                        <div>
                            <label for="title" class="block text-sm font-medium text-gray-700">Title *</label>
                            <input type="text" id="title" name="title" th:value="${item.title}" required
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm"
                                   placeholder="Enter item title">
                            <p class="mt-1 text-xs text-gray-500">A clear, descriptive title for your item.</p>
                        </div>
                        
                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="description" name="description" rows="4" th:text="${item.description}"
                                      class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm"
                                      placeholder="Enter item description"></textarea>
                            <p class="mt-1 text-xs text-gray-500">Provide additional details about this item.</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="category" class="block text-sm font-medium text-gray-700">Category *</label>
                                <input type="text" id="category" name="category" th:value="${item.category}" required
                                       list="categoryList"
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm"
                                       placeholder="Enter or select category">
                                <datalist id="categoryList">
                                    <option th:each="cat : ${categories}" th:value="${cat}"></option>
                                </datalist>
                                <p class="mt-1 text-xs text-gray-500">Categorize your item for better organization.</p>
                            </div>
                            
                            <div>
                                <label for="status" class="block text-sm font-medium text-gray-700">Status *</label>
                                <select id="status" name="status" required
                                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm">
                                    <option value="">Select Status</option>
                                    <option value="Active" th:selected="${item.status == 'Active'}">Active</option>
                                    <option value="Inactive" th:selected="${item.status == 'Inactive'}">Inactive</option>
                                    <option value="Pending" th:selected="${item.status == 'Pending'}">Pending</option>
                                    <option value="Completed" th:selected="${item.status == 'Completed'}">Completed</option>
                                    <option value="Draft" th:selected="${item.status == 'Draft'}">Draft</option>
                                    <option value="Archived" th:selected="${item.status == 'Archived'}">Archived</option>
                                </select>
                                <p class="mt-1 text-xs text-gray-500">Current status of this item.</p>
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-6">
                            <div class="flex justify-between items-center">
                                <div class="text-sm text-gray-500">
                                    <i class="fas fa-clock mr-1"></i>
                                    Created: <span th:text="${#temporals.format(item.createdAt, 'MMM dd, yyyy HH:mm')}"></span>
                                    <br>
                                    <i class="fas fa-edit mr-1"></i>
                                    Updated: <span th:text="${#temporals.format(item.updatedAt, 'MMM dd, yyyy HH:mm')}"></span>
                                </div>
                                
                                <div class="flex space-x-3">
                                    <a href="/" 
                                       class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded inline-flex items-center">
                                        <i class="fas fa-times mr-2"></i>
                                        Cancel
                                    </a>
                                    <button type="button" onclick="confirmSave()" 
                                            class="bg-primary hover:bg-blue-700 text-white font-bold py-2 px-4 rounded inline-flex items-center">
                                        <i class="fas fa-save mr-2"></i>
                                        Save Changes
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Confirm Save Modal -->
        <div id="confirmSaveModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
            <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/3 shadow-lg rounded-md bg-white">
                <div class="mt-3 text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4">
                        <i class="fas fa-save text-blue-600 text-xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Confirm Changes</h3>
                    <p class="text-sm text-gray-500 mb-4">
                        Are you sure you want to save these changes?
                    </p>
                    <div class="flex justify-center space-x-3">
                        <button type="button" onclick="closeSaveModal()" 
                                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">
                            Cancel
                        </button>
                        <button type="button" onclick="submitForm()" 
                                class="bg-primary-600 hover:bg-primary-700 text-white font-bold py-2 px-4 rounded">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:fragment="scripts">
        <script>
        function confirmSave() {
            document.getElementById('confirmSaveModal').classList.remove('hidden');
        }
        
        function closeSaveModal() {
            document.getElementById('confirmSaveModal').classList.add('hidden');
        }
        
        function submitForm() {
            document.querySelector('form').submit();
        }
        
        window.onclick = function(event) {
            if (event.target == document.getElementById('confirmSaveModal')) {
                closeSaveModal();
            }
        }
        
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeSaveModal();
            }
        });
        
        const form = document.querySelector('form');
        const inputs = form.querySelectorAll('input, textarea, select');
        let originalValues = {};
        
        inputs.forEach(input => {
            originalValues[input.name] = input.value;
        });
        
        function hasChanges() {
            return Array.from(inputs).some(input => input.value !== originalValues[input.name]);
        }
        
        window.addEventListener('beforeunload', function(e) {
            if (hasChanges()) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
        
        document.getElementById('title').addEventListener('input', function() {
            if (this.value.length > 100) {
                this.setCustomValidity('Title must be less than 100 characters');
            } else {
                this.setCustomValidity('');
            }
        });
        
        document.getElementById('category').addEventListener('input', function() {
            this.value = this.value.charAt(0).toUpperCase() + this.value.slice(1);
        });
        </script>
    </div>
</body>
</html>